# Spring Framework 설정

---

[Trouble shooting](#trouble-shooting)
[IntelliJ Setting](#intellij-에서-열기)

---

## 1. apache maven 폴더를 c 드라이브에서 압축풀고서 안에다가 repository 폴더 생성

`C:\apache-maven-3.9.1\repository` 이 경로를 복사
`C:\apache-maven-3.9.1\repository\conf` 경로 아래 `settings.xml` 파일에서

```xml
<settings xmlns="http://maven.apache.org/SETTINGS/1.2.0"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:schemaLocation="http://maven.apache.org/SETTINGS/1.2.0 https://maven.apache.org/xsd/settings-1.2.0.xsd">
  <!-- localRepository
   | The path to the local repository maven will use to store artifacts.
   |
   | Default: ${user.home}/.m2/repository
  <localRepository>/path/to/local/repo</localRepository>
  -->
```

이 부분을 찾아서 주석 밖에 `<localRepository>` 태그 만들고 경로를 추가

```xml
<localRepository>C:\apache-maven-3.9.1\repository</localRepository>
```

그리고 저장

---

[Maven repository](https://mvnrepository.com/) 에서 .jar 파일을 쓰는데 필요한 .xml 파일의 source code 를 가져다가 쓸 수 있음

---

## 2. spring tool suite 파일을 바탕화면에 압축 풀기

sts.exe (eclipse 기반 에디터)를 작업표시줄에 고정

## 3. Amazon Correcto JDK 11 을 설치

cmd 에서

``` powershell
java -version
```

으로 자바 버젼 확인

## 4. sts.exe 실행

c 드라이브에 spring-workspace 폴더 생성하고 경로로 잡음

---

## 5. Window/Preferences 설정

- `spelling`: `utf-8` 로 설정
general 밑에 `workspace utf-8` 로 설정
json > json files 인코딩: `ISO 10646/Unicode(UTF-8)`
web > CSS Files, HTML Files, JSP Files 모두: `ISO 10646/Unicode(UTF-8)`

server > runtime environments > 기본으로 있는거 삭제 하고서
apache tomcat 9.0 을 추가
jre 는 아까 설치한 11 버젼

## 6. 이제 서버도 apache tomcat 으로 생성

서버 포드 설정 80 으로 하고 예전에 하던거 그대로

---

## 7. 프로젝트 생성 spring legacy project 하고서 팝업창까지 뜨고 나면

C:\spring-workspace\.metadata\.plugins\org.springsource.ide.eclipse.commons.content.core

파일안에다가 https-content.xml 파일을 넣는다

그리고 다시 돌아와서 spring legacy project 만들기 하면 막 다른 파일들도 생겨 있음

templates 밑에 spring mvc project 라고 있음

그거 선택하고 이름도 지정하고서 다운받고 next

그리고 최상위 `package` 경로 `kr.or.iei` 으로 지정

## 8. window > preferences > maven > user setting 에서

아까 만든 C:\apache-maven-3.9.1\conf 에서 settings.xml 파일을 선택해준다

## 9. pom.xml 안에다가 설정을 해주면 자동으로 library 를 설치 해준다

pom.xml 에서 overview 탭 properties 탭에서
java-version : 11
org.springframework-version:5.0.6 으로

그리고 다시 `pom.xml` 탭으로 열어서 `source`, `target` 태그 안에 11 로 바꿔줌

```xml
<plugin>
   <groupId>org.apache.maven.plugins</groupId>
   <artifactId>maven-compiler-plugin</artifactId>
   <version>2.5.1</version>
   <configuration>
   <source>11</source>
   <target>11</target>
   <compilerArgument>-Xlint:all</compilerArgument>
   <showWarnings>true</showWarnings>
   <showDeprecation>true</showDeprecation>
   </configuration>
</plugin>
```

---

## 10. project 설정 properties > java build path > library > jre - edit - workspace default (jdk 11) 로 설정

java compiler 설정도 11 로 수정
project facets dynamic web module 4.0
java 11

targeted runtimes 에서 아파치 선택

web project setting > context root : /

deployment assembly 에서 maven dependencies 있는지 확인

-- customize shortcut 에서 원래 하던데로 추가하고

## 11. src/main/webapp/ 에다가 index.jsp 생성

-- 이제 서버 실행됨

web.xml 에서 dispatcherservlet 설정을 여기서함
프로젝트를 실행하면 이게 제일 먼저 실행됨

web.xml 파일 제일 위 `<context-param>` 태그 위에다가 다음과 같이 encodingfilter 설정을 해줌

```xml
<filter>
    <filter-name>characterEncoding</filter-name>
    <filter-class>org.springframework.web.filter.CharacterEncodingFilter</filter-class>
    <init-param>
    <param-name>encoding</param-name>
    <param-value>utf-8</param-value>
    </init-param>
</filter>
    <filter-mapping>
    <filter-name>characterEncoding</filter-name>
    <url-pattern>*.kh</url-pattern>
</filter-mapping>
```

`<filter-class>` 태그 안에 값에 ctrl+클릭하면 이동이 되는지 확인
그리고 아래에  

```xml
<servlet-mapping>
  <servlet-name>appServlet</servlet-name>
  <url-pattern>/</url-pattern>
</servlet-mapping>
```

글 복사해서

```xml
<servlet-mapping>
<servlet-name>appServlet</servlet-name>
<url-pattern>*.kh</url-pattern>
</servlet-mapping>
```

으로 수정해서 하나 더 작성

-- data base 연동을 할때는 pom.xml 파일 `<properties>` 태그 밑에 다음과 같이 작성

 ```xml
<!-- Maven repository 중앙 저장소에서 제공하지 않아서 따로 지정해줌 -->
<repositories>
  <repository>
    <id>Datanucleus</id>
    <url>https://www.datanucleus.org/downloads/maven2/</url>
  </repository>
</repositories>

<dependencies>
  <!-- https://mvnrepository.com/artifact/oracle/ojdbc6 -->
  <dependency>
    <groupId>oracle</groupId>
    <artifactId>ojdbc6</artifactId>
    <version>11.2.0.3</version>
  </dependency>

  <!-- DBCP data base connection pool -->
  <!-- https://mvnrepository.com/artifact/commons-dbcp/commons-dbcp -->
  <dependency>
    <groupId>commons-dbcp</groupId>
    <artifactId>commons-dbcp</artifactId>
    <version>1.4</version>
  </dependency>

  <!-- https://mvnrepository.com/artifact/org.springframework/spring-jdbc -->
  <dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-jdbc</artifactId>
    <version>${org.springframework-version}</version>
</dependency>
```

그러면 Maven Dependencies 밑에 추가되어진다
없으면 project 우클릭 maven > update project... 한다
가끔 가다가 설정이상해지는 경우 있는데 다시 해주면 됨 build path, compiler...

-- src/main/resources 밑에
new spring bean definition file 을 파일명 : applicationContext.xml

next 에서 bean > 4.3, context > 4.3, p 선택 하고서 생성
`<beans>` 태그 안에 아래와 같이 작성

```xml
 <!-- JdbcTemplate 를 Bean 으로 IoC 컨테이너에 등록하는것 -->
 <bean id="dataSource"
  class="org.apache.commons.dbcp.BasicDataSource">
  <property name="driverClassName"
   value="oracle.jdbc.driver.OracleDriver" />
  <property name="url"
   value="jdbc:oracle:thin:@127.0.0.1:1521:xe" />
  <property name="username" value="spring" />
  <property name="password" value="1234" />
 </bean>

 <bean id="jdbcTemplate"
  class="org.springframework.jdbc.core.JdbcTemplate">
  <property name="dataSource" ref="dataSource" />
 </bean>
 ```

-- web.xml 파일 에도 다음과 같이 수정

`<param-value>` 태그 안에 `Classpath:applicationContext.xml` 부분을 추가

```xml
<!-- Processes application requests -->
<servlet>
  <servlet-name>appServlet</servlet-name>
    <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
  <init-param>
    <param-name>contextConfigLocation</param-name>
    <param-value>/WEB-INF/spring/appServlet/servlet-context.xml
    Classpath:applicationContext.xml</param-value>
  </init-param>
  <load-on-startup>1</load-on-startup>
</servlet>
```

-- `taglib`는 버그가 있어서 직접 /WEB-INF/lib/ 안에다가 추가해준다

---

## Trouble Shooting

원인 : 처음에 maven 폴더 밑에 repository 폴더를 만들때 오타가 있어서 conf/settings.xml 파일에도 오타 그대로 경로를 지정했다가 수정하니까
증상 : 프로젝트에서 jar 파일들을 받아 오지 못함
해결 : project > properties > java build path > library > classpath > maven dependencies > Edit... > Maven project Setting - Resolve Dependencies from Workspace projects 를 체크 했다가 풀었다가 저장하고 컴퓨터까지 재시작하지까 됨

---

## IntelliJ 에서 열기

프로젝트 폴더만 복사에서 intellij-workspace 폴더를 새로 만들어서 그 안에다가 붙여넣고

Current File 에서 Edit Configurations... 하고

Add new 하고서 apache server > local

URL: `http://localhost:80`
VM options: `-Dfile.encoding=UTF-8`
HTTP port: `80`
Warning: No artifacts marked for deployment 에서 fix 누르고
 `iei:war exploded` 선택
Application context: `/`

---

### Happy Hacking  🎉
